<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: fittable/source/FittableLayout.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: fittable/source/FittableLayout.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(function (enyo, scope) {
    /**
    * _enyo.FittableLayout_ provides the base positioning and boundary logic for
    * the fittable layout strategy. The fittable layout strategy is based on
    * laying out items in either a set of rows or a set of columns, with most of
    * the items having natural size, but one item expanding to fill the remaining
    * space. The item that expands is labeled with the attribute _fit: true_.
    *
    * The subkinds [enyo.FittableColumnsLayout](#enyo.FittableColumnsLayout) and
    * [enyo.FittableRowsLayout](#enyo.FittableRowsLayout) (or _their_ subkinds)
    * are used for layout rather than _enyo.FittableLayout_ because they specify
    * properties that the framework expects to be available when laying items out.
    *
    * When available on the platform, you can opt-in to have _enyo.FittableLayout_ use CSS
    * flexible box (flexbox) to implement fitting behavior on the platform for better
    * performance, and will fall back to JS-based layout on older platforms.
    * There are three subtle differences between the flexbox and JS implementations
    * that should be noted:

    * - When using flexbox, vertical margins (`margin-top`, `margin-bottom`) will
    * not collapse; when using JS layout, vertical margin will collapse according
    * to static layout rules.
    * - When using flexbox, non-fitting children of the Fittable must not be sized
    * using percentages of the container (even if set to `position: relative`);
    * this is explicitly not supported by the flexbox 2013 spec.
    * - The flexbox-based Fittable implementation will respect multiple children
    * with `fit: true` (the fitting space will be divided equally between them).
    * This is NOT supported by the JS implementation, and should not be relied
    * on if deploying to platforms without flexbox support.
    *
    * The flexbox implementation was added to Enyo 2.5.0 as a performance optimization;
    * to opt-in to this optimization set `useFlex: true` on the
    * Fittable container, which will result in the use of flexbox when possible - noting the
    * subtle differences between the JS fittables implementation and flexbox.
    *
    * @ui
    * @class  enyo.FittableLayout
    * @extends enyo.Layout
    * @public
    */
    enyo.kind(/** @lends  enyo.FittableLayout.prototype */{
        name: 'enyo.FittableLayout',

        /**
        * @private
        */
        kind: 'Layout',

        /**
        * @private
        */
        noDefer: true,

		/**
		* @method
		* @private
		*/
        constructor: enyo.inherit(function (sup) {
            return function () {
                sup.apply(this, arguments);

                // Add the force-ltr class if we're in RTL mode, but this control is set explicitly to NOT be in RTL mode.
                this.container.addRemoveClass('force-left-to-right', (enyo.Control.prototype.rtl &amp;&amp; !this.container.get('rtl')) );

                // Flexbox optimization is determined by global flexAvailable and per-instance opt-in useFlex flag
                this.useFlex = enyo.FittableLayout.flexAvailable &amp;&amp; (this.container.useFlex === true);
                if (this.useFlex) {
                    this.container.addClass(this.flexLayoutClass);
                } else {
                    this.container.addClass(this.fitLayoutClass);
                }
            };
        }),

        /**
		* @method
		* @private
		*/
        calcFitIndex: function() {
            var aChildren = this.container.children,
                oChild,
                n;

            for (n=0; n&lt;aChildren.length; n++) {
                oChild = aChildren[n];
                if (oChild.fit &amp;&amp; oChild.showing) {
                    return n;
                }
            }
        },

        /**
		* @method
		* @private
		*/
        getFitControl: function() {
            var aChildren = this.container.children,
                oFitChild = aChildren[this.fitIndex];

            if (!(oFitChild &amp;&amp; oFitChild.fit &amp;&amp; oFitChild.showing)) {
                this.fitIndex = this.calcFitIndex();
                oFitChild = aChildren[this.fitIndex];
            }
            return oFitChild;
        },

        /**
		* @method
		* @private
		*/
        shouldReverse: function() {
            return this.container.rtl &amp;&amp; this.orient === 'h';
        },

        /**
		* @method
		* @private
		*/
        getFirstChild: function() {
            var aChildren = this.getShowingChildren();

            if (this.shouldReverse()) {
                return aChildren[aChildren.length - 1];
            } else {
                return aChildren[0];
            }
        },

        /**
		* @method
		* @private
		*/
        getLastChild: function() {
            var aChildren = this.getShowingChildren();

            if (this.shouldReverse()) {
                return aChildren[0];
            } else {
                return aChildren[aChildren.length - 1];
            }
        },

        /**
		* @method
		* @private
		*/
        getShowingChildren: function() {
            var a = [],
                n = 0,
                aChildren = this.container.children,
                nLength   = aChildren.length;

            for (;n&lt;nLength; n++) {
                if (aChildren[n].showing) {
                    a.push(aChildren[n]);
                }
            }

            return a;
        },

        /**
		* @method
		* @private
		*/
        _reflow: function(sMeasureName, sClienMeasure, sAttrBefore, sAttrAfter) {
            this.container.addRemoveClass('enyo-stretch', !this.container.noStretch);

            var oFitChild       = this.getFitControl(),
                oContainerNode  = this.container.hasNode(),  // Container node
                nTotalSize     = 0,                          // Total container width or height without padding
                nBeforeOffset   = 0,                         // Offset before fit child
                nAfterOffset    = 0,                         // Offset after fit child
                oPadding,                                    // Object containing t,b,r,l paddings
                oBounds,                                     // Bounds object of fit control
                oLastChild,
                oFirstChild,
                nFitSize;

            if (!oFitChild || !oContainerNode) { return; }

            oPadding   = enyo.dom.calcPaddingExtents(oContainerNode);
            oBounds    = oFitChild.getBounds();
            nTotalSize = oContainerNode[sClienMeasure] - (oPadding[sAttrBefore] + oPadding[sAttrAfter]);

            if (this.shouldReverse()) {
                oFirstChild  = this.getFirstChild();
                nAfterOffset = nTotalSize - (oBounds[sAttrBefore] + oBounds[sMeasureName]);

                var nMarginBeforeFirstChild = enyo.dom.getComputedBoxValue(oFirstChild.hasNode(), 'margin', sAttrBefore) || 0;

                if (oFirstChild == oFitChild) {
                    nBeforeOffset = nMarginBeforeFirstChild;
                } else {
                    var oFirstChildBounds      = oFirstChild.getBounds(),
                        nSpaceBeforeFirstChild = oFirstChildBounds[sAttrBefore];

                    nBeforeOffset = oBounds[sAttrBefore] + nMarginBeforeFirstChild - nSpaceBeforeFirstChild;
                }
            } else {
                oLastChild    = this.getLastChild();
                nBeforeOffset = oBounds[sAttrBefore] - (oPadding[sAttrBefore] || 0);

                var nMarginAfterLastChild = enyo.dom.getComputedBoxValue(oLastChild.hasNode(), 'margin', sAttrAfter) || 0;

                if (oLastChild == oFitChild) {
                    nAfterOffset = nMarginAfterLastChild;
                } else {
                    var oLastChildBounds = oLastChild.getBounds(),
                        nFitChildEnd     = oBounds[sAttrBefore] + oBounds[sMeasureName],
                        nLastChildEnd    = oLastChildBounds[sAttrBefore] + oLastChildBounds[sMeasureName] +  nMarginAfterLastChild;

                    nAfterOffset = nLastChildEnd - nFitChildEnd;
                }
            }

            nFitSize = nTotalSize - (nBeforeOffset + nAfterOffset);
            oFitChild.applyStyle(sMeasureName, nFitSize + 'px');
        },

        /**
        * Assigns any static layout properties not dependent on changes to the
        * rendered component or contaner sizes, etc.
        *
        * @method
        * @public
        */
        flow: function() {
            if (this.useFlex) {
                var i,
                    children = this.container.children,
                    child;
                this.container.addClass(this.flexLayoutClass);
                this.container.addRemoveClass('nostretch', this.container.noStretch);
                for (i=0; i&lt;children.length; i++) {
                    child = children[i];
                    child.addClass('enyo-flex-item');
                    child.addRemoveClass('flex', child.fit);
                }
            }
        },

        /**
        * Updates the layout to reflect any changes made to the layout container or
        * the contained components.
        *
        * @method
        * @public
        */
        reflow: function() {
            if (!this.useFlex) {
                if (this.orient == 'h') {
                    this._reflow('width', 'clientWidth', 'left', 'right');
                } else {
                    this._reflow('height', 'clientHeight', 'top', 'bottom');
                }
            }
        },

        /**
		* @private
        * @lends  enyo.FittableLayout.prototype
		*/
        statics: {
            /**
			* Controls if a Flex box optimization can be used.
			*
			* @type {Boolean}
			* @default  false
			* @private
			*/
            flexAvailable: false
        }
    });

    /**
    * _enyo.FittableColumnsLayout_ provides a container in which items are laid
    * out in a set of vertical columns, with most of the items having natural
    * size, but one expanding to fill the remaining space. The one that expands is
    * labeled with the attribute _fit: true_.
    *
    * _enyo.FittableColumnsLayout_ is meant to be used as a value for the
    * _layoutKind_ property of other kinds. _layoutKind_ provides a way to add
    * layout behavior in a pluggable fashion while retaining the ability to use a
    * specific base kind.

    * For more information, see the documentation on
    * [Fittables](building-apps/layout/fittables.html) in the Enyo Developer Guide.
    *
    * @ui
    * @class  enyo.FittableColumnsLayout
    * @extends enyo.FittableLayout
    * @public
    */
    enyo.kind(/** @lends  enyo.FittableColumnsLayout.prototype */{
        name        : 'enyo.FittableColumnsLayout',
        kind        : 'FittableLayout',
        orient      : 'h',
        fitLayoutClass : 'enyo-fittable-columns-layout',
        flexLayoutClass: 'enyo-flex-container columns'
    });


    /**
    * _enyo.FittableRowsLayout_ provides a container in which items are laid out
    * in a set of horizontal rows, with most of the items having natural size, but
    * one expanding to fill the remaining space. The one that expands is labeled
    * with the attribute _fit: true_.
    *
    * _enyo.FittableRowsLayout_ is meant to be used as a value for the
    * _layoutKind_ property of other kinds. _layoutKind_ provides a way to add
    * layout behavior in a pluggable fashion while retaining the ability to use a
    * specific base kind.
    *
    * For more information, see the documentation on
    * [Fittables](building-apps/layout/fittables.html) in the Enyo Developer Guide.
    *
    * @ui
    * @class  enyo.FittableRowsLayout
    * @extends enyo.FittableLayout
    * @public
    */
    enyo.kind({

        /**
        * @private
        */
        name        : 'enyo.FittableRowsLayout',

        /**
        * @private
        */
        kind        : 'FittableLayout',

        /**
        * Layout CSS class used to fit rows
        *
        * @public
        * @type {String}
        * @default 'enyo-fittable-rows-layout'
        */
        fitLayoutClass : 'enyo-fittable-rows-layout',

        /**
        * Sets the orientation of the layout
        *
        * @public
        * @default 'v'
        */
        orient      : 'v',

        /**
        * @private
        */
        flexLayoutClass: 'enyo-flex-container rows'
    });

    // One-time flexbox feature-detection
    (function() {
        var detector = document.createElement('div');
        enyo.FittableLayout.flexAvailable =
            (detector.style.flexBasis !== undefined) ||
            (detector.style.webkitFlexBasis !== undefined) ||
            (detector.style.mozFlexBasis !== undefined) ||
            (detector.style.msFlexBasis !== undefined);
    })();

})(enyo, this);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="enyo.Arranger.html">Arranger</a></li><li><a href="enyo.CardArranger.html">CardArranger</a></li><li><a href="enyo.CardSlideInArranger.html">CardSlideInArranger</a></li><li><a href="enyo.CarouselArranger.html">CarouselArranger</a></li><li><a href="enyo.CollapsingArranger.html">CollapsingArranger</a></li><li><a href="enyo.ContextualLayout.html">ContextualLayout</a></li><li><a href="enyo.DockRightArranger.html">DockRightArranger</a></li><li><a href="enyo.FittableColumns.html">FittableColumns</a></li><li><a href="enyo.FittableColumnsLayout.html">FittableColumnsLayout</a></li><li><a href="enyo.FittableLayout.html">FittableLayout</a></li><li><a href="enyo.FittableRows.html">FittableRows</a></li><li><a href="enyo.FittableRowsLayout.html">FittableRowsLayout</a></li><li><a href="enyo.LeftRightArranger.html">LeftRightArranger</a></li><li><a href="enyo.Node.html">Node</a></li><li><a href="enyo.Panels.html">Panels</a></li><li><a href="enyo.Slideable.html">Slideable</a></li><li><a href="enyo.SpiralArranger.html">SpiralArranger</a></li><li><a href="enyo.TopButtonArranger.html">TopButtonArranger</a></li></ul><h3>Events</h3><ul><li><a href="enyo.List.html#event:event:onReorder">event:onReorder</a></li><li><a href="enyo.List.html#event:event:onSetupItem">event:onSetupItem</a></li><li><a href="enyo.List.html#event:event:onSetupPinnedReorderComponents">event:onSetupPinnedReorderComponents</a></li><li><a href="enyo.List.html#event:event:onSetupReorderComponents">event:onSetupReorderComponents</a></li><li><a href="enyo.List.html#event:event:onSetupSwipeItem">event:onSetupSwipeItem</a></li><li><a href="enyo.List.html#event:event:onSwipe">event:onSwipe</a></li><li><a href="enyo.List.html#event:event:onSwipeComplete">event:onSwipeComplete</a></li><li><a href="enyo.List.html#event:event:onSwipeDrag">event:onSwipeDrag</a></li><li><a href="enyo.Node.html#event:event:onDestroyed">event:onDestroyed</a></li><li><a href="enyo.Node.html#event:event:onExpand">event:onExpand</a></li><li><a href="enyo.Node.html#event:event:onNodeDblClick">event:onNodeDblClick</a></li><li><a href="enyo.Node.html#event:event:onNodeTap">event:onNodeTap</a></li><li><a href="enyo.Panels.html#event:event:onTransitionFinish">event:onTransitionFinish</a></li><li><a href="enyo.Panels.html#event:event:onTransitionStart">event:onTransitionStart</a></li><li><a href="enyo.Slideable.html#event:event:onAnimateFinish">event:onAnimateFinish</a></li><li><a href="enyo.Slideable.html#event:event:onChange">event:onChange</a></li></ul><h3>Global</h3><ul><li><a href="global.html#animate">animate</a></li><li><a href="global.html#cleanupMemory">cleanupMemory</a></li><li><a href="global.html#defaultScale">defaultScale</a></li><li><a href="global.html#fitLayoutClass">fitLayoutClass</a></li><li><a href="global.html#horizontalDragPropagation">horizontalDragPropagation</a></li><li><a href="global.html#lowMemory">lowMemory</a></li><li><a href="global.html#orient">orient</a></li><li><a href="global.html#thumb">thumb</a></li><li><a href="global.html#touchOverscroll">touchOverscroll</a></li><li><a href="global.html#verticalDragPropagation">verticalDragPropagation</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Tue Jul 15 2014 15:12:54 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>

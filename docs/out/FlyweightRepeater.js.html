<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: list/source/FlyweightRepeater.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: list/source/FlyweightRepeater.js</h1>

    


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>(function (enyo, scope) {

	var HTMLStringDelegate = enyo.HTMLStringDelegate,
		FlyweightRepeaterDelegate = Object.create(HTMLStringDelegate);

	FlyweightRepeaterDelegate.generateInnerHtml = function (control) {
		var h = '';
		control.index = null;
		// note: can supply a rowOffset
		// and indicate if rows should be rendered top down or bottomUp
		for (var i=0, r=0; i&lt;control.count; i++) {
			r = control.rowOffset + (this.bottomUp ? control.count - i-1 : i);
			control.setupItem(r);
			control.$.client.setAttribute('data-enyo-index', r);
			if (control.orient == 'h') {
				control.$.client.setStyle('display:inline-block;');
			}
			h += HTMLStringDelegate.generateChildHtml(control);
			control.$.client.teardownRender();
		}
		return h;
	};

	/**
	* Fires once per row at render time.
	*
	* @event enyo.FlyweightRepeater#event:onSetupItem
	* @type {Object}
	* @property {Number} index     - Index of row
	* @property {Boolean} selected - `true` if row is selected
	* @public
	*/

	/**
	* Fires after an individual row has been rendered
	*
	* @event enyo.FlyweightRepeater#event:onRenderRow
	* @type {Object}
	* @property {Number} rowIndex - Index of row
	* @public
	*/

	/**
	* _enyo.FlyweightRepeater_ is a control that displays a repeating list of
	* rows, suitable for displaying medium-sized lists (up to ~100 items). A
	* flyweight strategy is employed to render one set of row controls, as needed,
	* for as many rows as are contained in the repeater.
	*
	* The FlyweightRepeater's `components` block contains the controls to be used
	* for a single row. This set of controls will be rendered for each row. You
	* may customize row rendering by handling the _onSetupItem_ event.
	*
	* The controls inside a FlyweightRepeater are non-interactive. This means that
	* calling methods that would normally cause rendering to occur (e.g.,
	* `set('content', value)`) will not do so. However, you may force a row to
	* render by calling `[renderRow(row)]{@link enyo.FlyweightRepeater#renderRow}`.
	*
	* In addition, you may force a row to be temporarily interactive by calling
	* `[prepareRow(row)]{@link enyo.FlyweightRepeater#prepareRow}`. Call the
	* `[lockRow(row)]{@link enyo.FlyweightRepeater#lockRow}` method when the interaction is
	* complete.
	*
	* For more information, see the documentation on
	* [Lists](building-apps/layout/lists.html) in the Enyo Developer Guide.
	*
	* @ui
	* @class enyo.FlyweightRepeater
	* @extends enyo.Control
	* @public
	*/
	enyo.kind(
		/** @lends enyo.FlyweightRepeater.prototype */ {

		/**
		* @private
		*/
		name: 'enyo.FlyweightRepeater',

		/**
		* @private
		*/
		kind: 'enyo.Control',

		/**
		* @lends enyo.FlyweightRepeater.prototype
		* @private
		*/
		published: {
			/**
			 * Number of rows to render
			 *
			 * @type {Number}
			 * @default 0
			 * @public
			 */
			count: 0,

			/**
			* If true, the selection mechanism is disabled. Tap events are still
			* sent, but items won't be automatically re-rendered when tapped.
			*
			* @type {Boolean}
			* @default false
			* @public
			*/
			noSelect: false,

			/**
			 * If true, multiple selections are allowed
			 *
			 * @type {Boolean}
			 * @default false
			 * @public
			 */
			multiSelect: false,

			/**
			 * If true, the selected item will toggle
			 *
			 * @type {Boolean}
			 * @default false
			 * @public
			 */
			toggleSelected: false,

			/**
			* Used to specify CSS classes for the repeater's wrapper component (client).
			* Input is identical to that of {@link enyo.Control#setClasses}.
			*
			* @type {String}
			* @default ''
			* @public
			*/
			clientClasses: '',

			/**
			* Used to specify custom styling for the repeater's wrapper component
			* (client). Input is identical to that of {@link enyo.Control#setStyle}.
			*
			* @type {String}
			* @default ''
			* @public
			*/
			clientStyle: '',

			/**
			* Numerical offset applied to row number during row generation. Allows items
			* to have natural indices instead of 0-based ones. This value must be
			* positive, as row number -1 is used to represent undefined rows in the
			* event system.
			*
			* @type {Number}
			* @default 0
			* @public
			*/
			rowOffset: 0,

			/**
			* Direction in which items will be laid out. Valid values are 'v' for
			* vertical or 'h' for horizontal.
			*
			* @type {String}
			* @default 'h'
			* @public
			*/
			orient: 'v'
		},

		/**
		* @private
		*/
		events: {
			onSetupItem: '',
			onRenderRow: ''
		},

		/**
		* Design-time attribute indicating whether row indices run
		* from 0 to `[count]{@link enyo.FlyweightRepeater#count}-1 (`false`) or
		* [count]{@link enyo.FlyweightRepeater#count}-1 to 0 (`true`)
		*
		* @type {Boolean}
		* @default false
		* @public
		*/
		bottomUp: false,

		/**
		* @private
		*/
		renderDelegate: FlyweightRepeaterDelegate,

		/**
		* @private
		*/
		components: [
			{kind: 'Selection', onSelect: 'selectDeselect', onDeselect: 'selectDeselect'},
			{name: 'client'}
		],

		/**
		* @method
		* @private
		*/
		create: enyo.inherit(function (sup) {
			return function () {
				sup.apply(this, arguments);
				this.noSelectChanged();
				this.multiSelectChanged();
				this.clientClassesChanged();
				this.clientStyleChanged();
			};
		}),

		/**
		* @private
		*/
		noSelectChanged: function () {
			if (this.noSelect) {
				this.$.selection.clear();
			}
		},

		/**
		* @private
		*/
		multiSelectChanged: function () {
			this.$.selection.setMulti(this.multiSelect);
		},

		/**
		* @private
		*/
		clientClassesChanged: function () {
			this.$.client.setClasses(this.clientClasses);
		},

		/**
		* @private
		*/
		clientStyleChanged: function () {
			this.$.client.setStyle(this.clientStyle);
		},

		/**
		* @fires enyo.FlyweightRepeater#event:onSetupItem
		* @private
		*/
		setupItem: function (index) {
			this.doSetupItem({index: index, selected: this.isSelected(index)});
		},

		/**
		* Renders the list
		*
		* @private
		*/
		generateChildHtml: function () {
			return this.renderDelegate.generateInnerHtml(this);
		},

		/**
		* @todo add link to preview.js
		* @private
		*/
		previewDomEvent: function (event) {
			var i = this.index = this.rowForEvent(event);
			event.rowIndex = event.index = i;
			event.flyweight = this;
		},

		/**
		* @method
		* @private
		*/
		decorateEvent: enyo.inherit(function (sup) {
			return function (eventName, event, sender) {
				// decorate event with index found via dom iff event does not already contain an index.
				var i = (event &amp;&amp; event.index != null) ? event.index : this.index;
				if (event &amp;&amp; i != null) {
					event.index = i;
					event.flyweight = this;
				}
				sup.apply(this, arguments);
			};
		}),

		/**
		* @private
		*/
		tap: function (sender, event) {
			// ignore taps if selecting is disabled or if they don't target a row
			if (this.noSelect || event.index === -1) {
				return;
			}
			if (this.toggleSelected) {
				this.$.selection.toggle(event.index);
			} else {
				this.$.selection.select(event.index);
			}
		},

		/**
		* Handler for selection and deselection
		*
		* @private
		*/
		selectDeselect: function (sender, event) {
			this.renderRow(event.key);
		},

		/**
		* Returns the repeater's [selection]{@link enyo.Selection} component.
		*
		* @return {enyo.Selection}
		* @public
		*/
		getSelection: function () {
			return this.$.selection;
		},

		/**
		* Gets the selection state for the given row index.
		*
		* @return {Boolean} - `true` if the row is selected
		* @public
		*/
		isSelected: function (index) {
			return this.getSelection().isSelected(index);
		},

		/**
		* Renders the a row
		*
		* @param {Number} index - Index of row
		* @fires enyo.FlyweightRepeater#event:onRenderRow
		* @public
		*/
		renderRow: function (index) {
			// do nothing if index is out-of-range
			if (index &lt; this.rowOffset || index >= this.count + this.rowOffset) {
				return;
			}
			//this.index = null;
			// always call the setupItem callback, as we may rely on the post-render state
			this.setupItem(index);
			var node = this.fetchRowNode(index);
			if (node) {
				// hack to keep this working...
				var delegate = enyo.HTMLStringDelegate;

				enyo.dom.setInnerHtml(node, delegate.generateChildHtml(this.$.client));
				this.$.client.teardownChildren();
				this.doRenderRow({rowIndex: index});
			}
		},

		/**
		* Fetches the DOM node for the given row index.
		*
		* @param {Number} index - Index of row
		* @return {Node}
		* @public
		*/
		fetchRowNode: function (index) {
			if (this.hasNode()) {
				return this.node.querySelector('[data-enyo-index=' + index + ']');
			}
		},

		/**
		* Fetches the row number corresponding with the target of a given event.
		*
		* @param {Object} event - Event object
		* @return {Number}      - Index of row
		* @public
		*/
		rowForEvent: function (event) {
			if (!this.hasNode()) {
				return -1;
			}
			var n = event.target;
			while (n &amp;&amp; n !== this.node) {
				var i = n.getAttribute &amp;&amp; n.getAttribute('data-enyo-index');
				if (i !== null) {
					return Number(i);
				}
				n = n.parentNode;
			}
			return -1;
		},

		/**
		* Prepares the row specified by `index` such that changes made to the
		* controls inside the repeater will be rendered for the given row.
		*
		* @param {Number} index - Index of row
		* @public
		*/
		prepareRow: function (index) {
			// do nothing if index is out-of-range
			if (index &lt; this.rowOffset || index >= this.count + this.rowOffset) {
				return;
			}
			// update row internals to match model
			this.setupItem(index);
			var n = this.fetchRowNode(index);
			enyo.FlyweightRepeater.claimNode(this.$.client, n);
		},

		/**
		* Prevents rendering of changes made to controls inside the repeater.
		*
		* @public
		*/
		lockRow: function () {
			this.$.client.teardownChildren();
		},

		/**
		* Prepares the row specified by `index` such that changes made to the
		* controls in the row will be rendered in the given row; then performs the
		* function `func`, and, finally, locks the row.
		*
		* @param {Number} index   - Index of row
		* @param {Function} func  - Function to perform
		* @param {Object} context - Context on which `func` is bound
		* @private
		*/
		performOnRow: function (index, func, context) {
			// do nothing if index is out-of-range
			if (index &lt; this.rowOffset || index >= this.count + this.rowOffset) {
				return;
			}
			if (func) {
				this.prepareRow(index);
				enyo.call(context || null, func);
				this.lockRow();
			}
		},

		/**
		* @lends enyo.FlyweightRepeater
		* @private
		*/
		statics: {
			/**
			* Associates a flyweight rendered control (`control`) with a
			* rendering context specified by `node`.
			*
			* @param {enyo.Control} control - Flyweight-rendered control
			* @param {Node} node - DOM Node to associate with `control`
			* @public
			*/
			claimNode: function (control, node) {
				var n;
				if (node) {
					if (node.id !== control.id) {
						n = node.querySelector('#' + control.id);
					} else {
						// node is already the right node, so just use it
						n = node;
					}
				}
				// FIXME: consider controls generated if we found a node or tag: null, the later so can teardown render
				control.generated = Boolean(n || !control.tag);
				control.node = n;
				if (control.node) {
					control.rendered();
				} else {
					//enyo.log('Failed to find node for',  control.id, control.generated);
				}
				// update control's class cache based on the node contents
				for (var i=0, c$=control.children, c; (c=c$[i]); i++) {
					this.claimNode(c, node);
				}
			}
		}
	});
})(enyo, this);</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="enyo.AlphaJumper.html">AlphaJumper</a></li><li><a href="enyo.AlphaJumpList.html">AlphaJumpList</a></li><li><a href="enyo.AroundList.html">AroundList</a></li><li><a href="enyo.Arranger.html">Arranger</a></li><li><a href="enyo.CardArranger.html">CardArranger</a></li><li><a href="enyo.CardSlideInArranger.html">CardSlideInArranger</a></li><li><a href="enyo.CarouselArranger.html">CarouselArranger</a></li><li><a href="enyo.CollapsingArranger.html">CollapsingArranger</a></li><li><a href="enyo.ContextualLayout.html">ContextualLayout</a></li><li><a href="enyo.DockRightArranger.html">DockRightArranger</a></li><li><a href="enyo.FittableColumns.html">FittableColumns</a></li><li><a href="enyo.FittableColumnsLayout.html">FittableColumnsLayout</a></li><li><a href="enyo.FittableHeaderLayout.html">FittableHeaderLayout</a></li><li><a href="enyo.FittableLayout.html">FittableLayout</a></li><li><a href="enyo.FittableRows.html">FittableRows</a></li><li><a href="enyo.FittableRowsLayout.html">FittableRowsLayout</a></li><li><a href="enyo.FlyweightRepeater.html">FlyweightRepeater</a></li><li><a href="enyo.GridListImageItem.html">GridListImageItem</a></li><li><a href="enyo.LeftRightArranger.html">LeftRightArranger</a></li><li><a href="enyo.List.html">List</a></li><li><a href="enyo.Node.html">Node</a></li><li><a href="enyo.Panels.html">Panels</a></li><li><a href="enyo.PulldownList.html">PulldownList</a></li><li><a href="enyo.Puller.html">Puller</a></li><li><a href="enyo.Slideable.html">Slideable</a></li><li><a href="enyo.SpiralArranger.html">SpiralArranger</a></li><li><a href="enyo.TopButtonArranger.html">TopButtonArranger</a></li></ul><h3>Events</h3><ul><li><a href="enyo.AlphaJumper.html#event:event:onAlphaJump">event:onAlphaJump</a></li><li><a href="enyo.AlphaJumpList.html#event:event:onReorder">event:onReorder</a></li><li><a href="enyo.AlphaJumpList.html#event:event:onSetupItem">event:onSetupItem</a></li><li><a href="enyo.AlphaJumpList.html#event:event:onSetupPinnedReorderComponents">event:onSetupPinnedReorderComponents</a></li><li><a href="enyo.AlphaJumpList.html#event:event:onSetupReorderComponents">event:onSetupReorderComponents</a></li><li><a href="enyo.AlphaJumpList.html#event:event:onSetupSwipeItem">event:onSetupSwipeItem</a></li><li><a href="enyo.AlphaJumpList.html#event:event:onSwipe">event:onSwipe</a></li><li><a href="enyo.AlphaJumpList.html#event:event:onSwipeComplete">event:onSwipeComplete</a></li><li><a href="enyo.AlphaJumpList.html#event:event:onSwipeDrag">event:onSwipeDrag</a></li><li><a href="enyo.AroundList.html#event:event:onReorder">event:onReorder</a></li><li><a href="enyo.AroundList.html#event:event:onSetupItem">event:onSetupItem</a></li><li><a href="enyo.AroundList.html#event:event:onSetupPinnedReorderComponents">event:onSetupPinnedReorderComponents</a></li><li><a href="enyo.AroundList.html#event:event:onSetupReorderComponents">event:onSetupReorderComponents</a></li><li><a href="enyo.AroundList.html#event:event:onSetupSwipeItem">event:onSetupSwipeItem</a></li><li><a href="enyo.AroundList.html#event:event:onSwipe">event:onSwipe</a></li><li><a href="enyo.AroundList.html#event:event:onSwipeComplete">event:onSwipeComplete</a></li><li><a href="enyo.AroundList.html#event:event:onSwipeDrag">event:onSwipeDrag</a></li><li><a href="enyo.FlyweightRepeater.html#event:event:onRenderRow">event:onRenderRow</a></li><li><a href="enyo.FlyweightRepeater.html#event:event:onSetupItem">event:onSetupItem</a></li><li><a href="enyo.List.html#event:event:onReorder">event:onReorder</a></li><li><a href="enyo.List.html#event:event:onSetupItem">event:onSetupItem</a></li><li><a href="enyo.List.html#event:event:onSetupPinnedReorderComponents">event:onSetupPinnedReorderComponents</a></li><li><a href="enyo.List.html#event:event:onSetupReorderComponents">event:onSetupReorderComponents</a></li><li><a href="enyo.List.html#event:event:onSetupSwipeItem">event:onSetupSwipeItem</a></li><li><a href="enyo.List.html#event:event:onSwipe">event:onSwipe</a></li><li><a href="enyo.List.html#event:event:onSwipeComplete">event:onSwipeComplete</a></li><li><a href="enyo.List.html#event:event:onSwipeDrag">event:onSwipeDrag</a></li><li><a href="enyo.Node.html#event:event:onDestroyed">event:onDestroyed</a></li><li><a href="enyo.Node.html#event:event:onExpand">event:onExpand</a></li><li><a href="enyo.Node.html#event:event:onNodeDblClick">event:onNodeDblClick</a></li><li><a href="enyo.Node.html#event:event:onNodeTap">event:onNodeTap</a></li><li><a href="enyo.Panels.html#event:event:onTransitionFinish">event:onTransitionFinish</a></li><li><a href="enyo.Panels.html#event:event:onTransitionStart">event:onTransitionStart</a></li><li><a href="enyo.PulldownList.html#event:event:onPull">event:onPull</a></li><li><a href="enyo.PulldownList.html#event:event:onPullCancel">event:onPullCancel</a></li><li><a href="enyo.PulldownList.html#event:event:onPullComplete">event:onPullComplete</a></li><li><a href="enyo.PulldownList.html#event:event:onPullRelease">event:onPullRelease</a></li><li><a href="enyo.PulldownList.html#event:event:onPullStart">event:onPullStart</a></li><li><a href="enyo.PulldownList.html#event:event:onReorder">event:onReorder</a></li><li><a href="enyo.PulldownList.html#event:event:onSetupItem">event:onSetupItem</a></li><li><a href="enyo.PulldownList.html#event:event:onSetupPinnedReorderComponents">event:onSetupPinnedReorderComponents</a></li><li><a href="enyo.PulldownList.html#event:event:onSetupReorderComponents">event:onSetupReorderComponents</a></li><li><a href="enyo.PulldownList.html#event:event:onSetupSwipeItem">event:onSetupSwipeItem</a></li><li><a href="enyo.PulldownList.html#event:event:onSwipe">event:onSwipe</a></li><li><a href="enyo.PulldownList.html#event:event:onSwipeComplete">event:onSwipeComplete</a></li><li><a href="enyo.PulldownList.html#event:event:onSwipeDrag">event:onSwipeDrag</a></li><li><a href="enyo.Puller.html#event:event:onCreate">event:onCreate</a></li><li><a href="enyo.Slideable.html#event:event:onAnimateFinish">event:onAnimateFinish</a></li><li><a href="enyo.Slideable.html#event:event:onChange">event:onChange</a></li></ul><h3>Global</h3><ul><li><a href="global.html#animate">animate</a></li><li><a href="global.html#cleanupMemory">cleanupMemory</a></li><li><a href="global.html#defaultScale">defaultScale</a></li><li><a href="global.html#horizontalDragPropagation">horizontalDragPropagation</a></li><li><a href="global.html#lowMemory">lowMemory</a></li><li><a href="global.html#thumb">thumb</a></li><li><a href="global.html#touchOverscroll">touchOverscroll</a></li><li><a href="global.html#verticalDragPropagation">verticalDragPropagation</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha9</a> on Wed Jul 16 2014 16:39:22 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
